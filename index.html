<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Not√≠cias de Mo√ßambique</title>
<meta name="description" content="Agregador de not√≠cias de Mo√ßambique em tempo real">
<meta name="robots" content="index, follow">
<style>
body{
    font-family:Arial,sans-serif;
    background:#f2f3f5;
    margin:0;
}

/* HEADER */
header{
    background:#1a73e8;
    color:white;
    padding:18px;
    text-align:center;
    font-size:20px;
    font-weight:bold;
    position:relative;
}

.header-btn{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    background:white;
    color:#1a73e8;
    border:none;
    padding:7px 12px;
    border-radius:8px;
    cursor:pointer;
    font-size:18px;
    font-weight:bold;
}

#menu-btn{ left:15px; }
#refresh-btn{ right:15px; }

/* SIDEBAR */
#sidebar-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.5);
    display:none;
    z-index:9998;
}

#sidebar{
    position:fixed;
    top:0;
    left:-280px;
    width:280px;
    height:100vh;
    background:#fff;
    box-shadow:2px 0 6px rgba(0,0,0,.2);
    padding:20px;
    box-sizing:border-box;
    transition:.3s;
    z-index:9999;
}

#sidebar.open{
    left:0;
}

#sidebar h2{
    color:#1a73e8;
    margin-top:0;
    font-size:18px;
}

#sidebar p{
    font-size:14px;
    color:#555;
    line-height:1.5;
}

#sidebar .contact div{
    margin:8px 0;
    font-size:14px;
}

#close-sidebar{
    position:absolute;
    top:15px;
    right:15px;
    cursor:pointer;
    font-size:18px;
}

/* SEARCH */
.search-container{
    max-width:950px;
    margin:12px auto;
    padding:0 12px;
}
#search-input{
    width:100%;
    padding:12px;
    border-radius:8px;
    border:1px solid #ddd;
    font-size:16px;
}

/* LISTA */
#news-container{
    max-width:950px;
    margin:auto;
    padding:12px;
}

.card{
    background:white;
    border-radius:12px;
    padding:12px;
    margin-bottom:12px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 2px 5px rgba(0,0,0,.08);
    cursor:pointer;
    transition:.2s;
    animation: fadeIn 0.5s ease-out;
}
.card:hover{ transform:scale(1.01); }

@keyframes fadeIn {
    from { 
        opacity: 0; 
        transform: translateY(20px); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0); 
    }
}

.card-text{ width:70%; }
.card-title{ 
    font-size:16px;
    font-weight:bold;
    color:#111;
    margin-bottom:4px;
    line-height:1.3;
}
.card-meta{
    font-size:12px;
    color:#777;
    display:flex;
    align-items:center;
    gap:8px;
}

.source-tag{
    background:#e8f0fe;
    color:#1a73e8;
    padding:2px 8px;
    border-radius:12px;
    font-size:11px;
    font-weight:bold;
}

.card img{
    width:120px;
    height:85px;
    object-fit:cover;
    border-radius:10px;
    background:#ddd;
}

/* LOADER INFINITO */
#infinite-loader {
    text-align: center;
    padding: 20px;
    color: #666;
    font-size: 14px;
}

.infinite-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #1a73e8;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-right: 10px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* MODAL */
#modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    justify-content:center;
    align-items:center;
    z-index:10000;
}
#modal-content{
    background:white;
    max-width:800px;
    width:90%;
    padding:25px;
    border-radius:12px;
    max-height:90vh;
    overflow:auto;
    position:relative;
}
#modal-close{
    position:absolute;
    top:15px;
    right:15px;
    cursor:pointer;
    font-size:22px;
    color:#666;
    z-index:1;
}

/* SHARE BUTTONS */
.share-section {
    margin: 25px 0 15px;
    padding-top: 15px;
    border-top: 1px solid #eee;
}

.share-title {
    font-size: 14px;
    color: #666;
    margin-bottom: 10px;
}

.share-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.share-btn {
    padding: 8px 16px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
}

.share-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}

.share-btn.facebook {
    background: #1877f2;
    color: white;
}

.share-btn.twitter {
    background: #1da1f2;
    color: white;
}

.share-btn.whatsapp {
    background: #25d366;
    color: white;
}

.share-btn.link {
    background: #6c757d;
    color: white;
}

.share-btn.link.copied {
    background: #28a745;
}

/* WHATSAPP FLOATING BUTTON */
.whatsapp-channel-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #25d366;
    background-image: url('https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp_Logo_green.svg');
    background-repeat: no-repeat;
    background-position: center;
    background-size: 65%;
    color: white;
    border: none;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
    z-index: 1000;
    font-size: 0;
    transition: all 0.3s ease;
    padding: 0;
}

.whatsapp-channel-btn:hover {
    transform: translateY(-3px) scale(1.1);
    box-shadow: 0 6px 16px rgba(37, 211, 102, 0.4);
}

.whatsapp-channel-btn::after {
    content: attr(title);
    position: absolute;
    right: 70px;
    background: #25d366;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 14px;
    white-space: nowrap;
    opacity: 0;
    transform: translateX(10px);
    transition: all 0.3s ease;
    pointer-events: none;
}

.whatsapp-channel-btn:hover::after {
    opacity: 1;
    transform: translateX(0);
}

/* PLATFORM INFO */
.platform-info {
    margin-top: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #1a73e8;
}

.platform-info p {
    margin: 0;
    font-size: 14px;
    color: #555;
}
</style>
</head>
<body>
<header>
<button class="header-btn" id="menu-btn" onclick="openSidebar()">‚ò∞</button>
üì∞ Not√≠cias de Mo√ßambique
<button class="header-btn" id="refresh-btn" onclick="manualRefresh()">‚Üª</button>
</header>

<!-- SIDEBAR -->
<div id="sidebar-overlay"></div>
<div id="sidebar">
<span id="close-sidebar" onclick="closeSidebar()">‚úñ</span>
<h2>Sobre a Plataforma</h2>
<p>
Agregador independente de not√≠cias de Mo√ßambique,
reunindo conte√∫dos de v√°rias fontes confi√°veis em tempo real.
</p>
<h2>Contacto</h2>
<div class="contact">
<div>üìß claudioarmando001@gmail.com</div>
<div>üìû +258 869 667 677</div>
</div>
</div>

<!-- BUSCA -->
<div class="search-container">
<input id="search-input" placeholder="üîç Buscar not√≠cias..." onkeyup="searchNews()">
</div>

<!-- LISTA COM RENDERIZA√á√ÉO EM TEMPO REAL -->
<div id="news-container">
<!-- Not√≠cias aparecer√£o aqui automaticamente -->
</div>

<!-- LOADER PARA SCROLL INFINITO -->
<div id="infinite-loader" style="display:none;">
    <div class="infinite-spinner"></div>
    Carregando mais not√≠cias...
</div>

<!-- MODAL -->
<div id="modal">
<div id="modal-content">
<span id="modal-close">‚úñ</span>
<div id="modal-body"></div>
</div>
</div>

<!-- WHATSAPP CHANNEL BUTTON -->
<button class="whatsapp-channel-btn" onclick="openWhatsAppChannel()" title="Canal WhatsApp" aria-label="Abrir canal oficial no WhatsApp">
</button>

<script>
// VARI√ÅVEIS GLOBAIS
let news = []; // Todas as not√≠cias carregadas
let filteredNews = []; // Not√≠cias filtradas para busca
let hashes = new Set(); // Para evitar duplicatas
const BATCH_SIZE = 15; // Quantas not√≠cias carregar por fonte
let isLoadingMore = false; // Flag para evitar m√∫ltiplos carregamentos
let allSourcesLoaded = false; // Se todas as fontes foram completamente carregadas

// ELEMENTOS DOM
const container = document.getElementById("news-container");
const infiniteLoader = document.getElementById("infinite-loader");

// CONSTANTES
const PLATFORM_URL = window.location.href;
const WHATSAPP_CHANNEL_URL = "https://whatsapp.com/channel/0029VajvaaDCcW4indlczf2g";

// CONFIGURA√á√ÉO DAS FONTES
const sources = [
    { 
        name: "O Pa√≠s", 
        baseUrl: "https://www.opais.co.mz/wp-json/wp/v2/posts",
        currentPage: 1,
        hasMore: true,
        isFetching: false
    },
    { 
        name: "Carta de Mo√ßambique", 
        baseUrl: "https://cartamz.com/wp-json/wp/v2/posts",
        currentPage: 1,
        hasMore: true,
        isFetching: false
    },
    { 
        name: "Jornal Not√≠cias", 
        baseUrl: "https://www.jornalnoticias.co.mz/wp-json/wp/v2/posts",
        currentPage: 1,
        hasMore: true,
        isFetching: false
    }
];

/* ========== FUN√á√ïES DE INTERFACE ========== */

/* SIDEBAR */
function openSidebar(){
    document.getElementById("sidebar").classList.add("open");
    document.getElementById("sidebar-overlay").style.display="block";
}
function closeSidebar(){
    document.getElementById("sidebar").classList.remove("open");
    document.getElementById("sidebar-overlay").style.display="none";
}

document.getElementById('sidebar-overlay').addEventListener('click', function(event) {
    if (event.target === this) {
        closeSidebar();
    }
});

/* DATA */
function formatDate(d){
    return new Date(d).toLocaleString("pt-PT");
}

/* BUSCA */
function searchNews(){
    const q=document.getElementById("search-input").value.toLowerCase();
    filteredNews=news.filter(n=>
        n.title.toLowerCase().includes(q) || 
        n.source.toLowerCase().includes(q)
    );
    
    // Limpa e re-renderiza todas as not√≠cias filtradas
    container.innerHTML = '';
    filteredNews.forEach(article => {
        renderSingleNews(article);
    });
}

/* ========== RENDERIZA√á√ÉO EM TEMPO REAL ========== */

// Renderiza uma √∫nica not√≠cia imediatamente
function renderSingleNews(article) {
    if (container.querySelector(`[data-hash="${article.hash}"]`)) return;
    
    const c = document.createElement("div");
    c.className = "card";
    c.dataset.hash = article.hash;
    c.innerHTML = `
    <div class="card-text">
        <div class="card-title">${article.title}</div>
        <div class="card-meta">
            <span class="source-tag">${article.source}</span>
            <span>${formatDate(article.date)}</span>
        </div>
    </div>
    <img src="${article.image}" loading="lazy" alt="${article.title}">
    `;
    c.onclick = () => openModal(article);
    
    // Adiciona no topo (mais recente primeiro)
    if (container.children.length > 0) {
        container.insertBefore(c, container.children[0]);
    } else {
        container.appendChild(c);
    }
}

/* ========== MODAL E COMPARTILHAMENTO ========== */

function openModal(article) {
    const shareText = `üì∞ ${article.title} | Via Not√≠cias de Mo√ßambique`;
    const shareUrl = PLATFORM_URL;
    
    const modalContent = `
    <h2 style="margin-right:30px">${article.title}</h2>
    <p><i>${article.source} ‚Ä¢ ${formatDate(article.date)}</i></p>
    ${article.image !== 'https://via.placeholder.com/300x200' ? 
        `<img src="${article.image}" style="width:100%;border-radius:10px;margin:15px 0" alt="${article.title}">` : ''
    }
    <div>${article.content}</div>
    
    <div class="share-section">
        <div class="share-title">Partilhar esta plataforma:</div>
        <div class="share-buttons">
            <button class="share-btn facebook" onclick="shareOnFacebook('${encodeURIComponent(shareText)}', '${encodeURIComponent(shareUrl)}')">
                <span>f</span> Facebook
            </button>
            <button class="share-btn twitter" onclick="shareOnTwitter('${encodeURIComponent(shareText)}', '${encodeURIComponent(shareUrl)}')">
                <span>ùïè</span> Twitter
            </button>
            <button class="share-btn whatsapp" onclick="shareOnWhatsApp('${encodeURIComponent(shareText)}', '${encodeURIComponent(shareUrl)}')">
                <span>‚úì</span> WhatsApp
            </button>
            <button class="share-btn link" onclick="copyLink('${shareUrl}', this)">
                <span>üîó</span> Copiar Link
            </button>
        </div>
    </div>
    
    <div class="platform-info">
        <p>üí° <strong>Nota:</strong> Partilhe a plataforma Not√≠cias de Mo√ßambique para que mais pessoas possam acompanhar as √∫ltimas not√≠cias do pa√≠s!</p>
    </div>
    `;
    
    document.getElementById("modal-body").innerHTML = modalContent;
    document.getElementById("modal").style.display = "flex";
}

function shareOnFacebook(title, url) {
    const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(title)}`;
    window.open(shareUrl, '_blank', 'width=600,height=400');
}

function shareOnTwitter(title, url) {
    const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}`;
    window.open(shareUrl, '_blank', 'width=600,height=400');
}

function shareOnWhatsApp(title, url) {
    const text = `${title} - ${url}`;
    const shareUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
    window.open(shareUrl, '_blank', 'width=600,height=600');
}

function copyLink(url, button) {
    navigator.clipboard.writeText(url).then(() => {
        const originalText = button.innerHTML;
        button.innerHTML = '<span>‚úì</span> Link Copiado!';
        button.classList.add('copied');
        
        setTimeout(() => {
            button.innerHTML = originalText;
            button.classList.remove('copied');
        }, 2000);
    }).catch(err => {
        console.error('Erro ao copiar link:', err);
        alert('N√£o foi poss√≠vel copiar o link');
    });
}

function openWhatsAppChannel() {
    window.open(WHATSAPP_CHANNEL_URL, '_blank', 'noopener,noreferrer');
}

/* FECHAR MODAL */
document.getElementById("modal-close").onclick = () => {
    document.getElementById("modal").style.display = "none";
};

document.getElementById("modal").onclick = (e) => {
    if (e.target.id === 'modal') {
        document.getElementById("modal").style.display = "none";
    }
};

/* ========== CARREGAMENTO DE NOT√çCIAS EM TEMPO REAL ========== */

// Processa artigos de uma fonte e renderiza imediatamente
async function processSourceArticles(source, articles) {
    for (const article of articles) {
        const hash = (article.title.rendered + article.link).replace(/\W/g, "");
        
        if (hashes.has(hash)) continue;
        
        hashes.add(hash);
        
        const newsItem = {
            title: article.title.rendered,
            content: article.content.rendered,
            image: article._embedded?.["wp:featuredmedia"]?.[0]?.source_url || 
                   article.jetpack_featured_media_url ||
                   "https://via.placeholder.com/300x200",
            source: source.name,
            date: article.date || article.modified,
            link: article.link,
            hash: hash
        };
        
        // Adiciona √†s listas
        news.push(newsItem);
        filteredNews.push(newsItem);
        
        // Renderiza IMEDIATAMENTE
        renderSingleNews(newsItem);
        
        // Pequena pausa para anima√ß√£o suave
        await new Promise(resolve => setTimeout(resolve, 30));
    }
}

// Carrega not√≠cias de uma fonte espec√≠fica
async function loadSource(source) {
    if (!source.hasMore || source.isFetching) return;
    
    source.isFetching = true;
    
    try {
        const url = `${source.baseUrl}?_embed&per_page=${BATCH_SIZE}&page=${source.currentPage}&t=${Date.now()}`;
        const response = await fetch(url);
        
        if (!response.ok) {
            if (response.status === 400) {
                source.hasMore = false;
            }
            throw new Error(`Erro ao buscar ${source.name}`);
        }
        
        const data = await response.json();
        
        if (data.length === 0) {
            source.hasMore = false;
            return;
        }
        
        source.currentPage++;
        
        // Processa e renderiza as not√≠cias imediatamente
        await processSourceArticles(source, data);
        
    } catch (error) {
        console.error(`Erro ao carregar ${source.name}:`, error);
        source.hasMore = false;
    } finally {
        source.isFetching = false;
        
        // Verifica se todas as fontes foram carregadas
        checkAllSourcesLoaded();
    }
}

// Carrega not√≠cias de todas as fontes simultaneamente
async function loadAllSources() {
    // Limpa dados anteriores
    news = [];
    filteredNews = [];
    hashes.clear();
    allSourcesLoaded = false;
    
    // Limpa o container
    container.innerHTML = '';
    
    // Reseta fontes
    sources.forEach(source => {
        source.currentPage = 1;
        source.hasMore = true;
        source.isFetching = false;
    });
    
    // Carrega todas as fontes em paralelo
    const promises = sources.map(source => loadSource(source));
    
    // Aguarda todas as fontes terminarem o primeiro carregamento
    await Promise.allSettled(promises);
    
    // Ordena todas as not√≠cias por data (mais recente primeiro)
    filteredNews.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    // Reorganiza as not√≠cias na tela por data
    reorderNewsByDate();
}

// Reorganiza as not√≠cias na tela por data (mais recente primeiro)
function reorderNewsByDate() {
    // Remove todas as not√≠cias do container
    while (container.firstChild) {
        container.removeChild(container.firstChild);
    }
    
    // Adiciona novamente em ordem
    filteredNews.forEach(article => {
        renderSingleNews(article);
    });
}

// Carrega mais not√≠cias (scroll infinito)
async function loadMoreNews() {
    if (isLoadingMore || allSourcesLoaded) return;
    
    isLoadingMore = true;
    infiniteLoader.style.display = 'block';
    
    let anySourceHasMore = false;
    const promises = [];
    
    // Carrega de todas as fontes que ainda t√™m conte√∫do
    for (const source of sources) {
        if (source.hasMore) {
            promises.push(loadSource(source));
            
            if (source.hasMore) {
                anySourceHasMore = true;
            }
        }
    }
    
    // Aguarda todas as fontes terminarem
    await Promise.allSettled(promises);
    
    // Verifica se todas as fontes foram completamente carregadas
    allSourcesLoaded = !anySourceHasMore;
    
    isLoadingMore = false;
    infiniteLoader.style.display = 'none';
}

function checkAllSourcesLoaded() {
    allSourcesLoaded = sources.every(source => !source.hasMore);
    
    if (allSourcesLoaded) {
        infiniteLoader.style.display = 'none';
    }
}

/* ========== CONTROLES ========== */

function manualRefresh() {
    // Limpa o container
    container.innerHTML = '';
    
    // Recarrega tudo
    loadAllSources();
}

/* ========== SCROLL INFINITO ========== */

let scrollTimeout;
const SCROLL_THRESHOLD = 300;

window.addEventListener("scroll", () => {
    if (scrollTimeout) clearTimeout(scrollTimeout);
    
    scrollTimeout = setTimeout(() => {
        const scrollPosition = window.innerHeight + window.scrollY;
        const threshold = document.body.offsetHeight - SCROLL_THRESHOLD;
        
        if (scrollPosition >= threshold && !isLoadingMore && !allSourcesLoaded) {
            loadMoreNews();
        }
    }, 150);
});

/* ========== INICIALIZA√á√ÉO ========== */

// Inicia o carregamento
loadAllSources();

// Atualiza a cada 5 minutos se a p√°gina estiver vis√≠vel
setInterval(() => {
    if (document.visibilityState === 'visible' && !isLoadingMore) {
        // Carrega apenas se o usu√°rio estiver no final da p√°gina
        const scrollPosition = window.innerHeight + window.scrollY;
        const threshold = document.body.offsetHeight - 500;
        
        if (scrollPosition >= threshold) {
            loadMoreNews();
        }
    }
}, 300000);

/* ========== ATALHOS DE TECLADO ========== */

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        document.getElementById("modal").style.display = "none";
        closeSidebar();
    }
    
    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
        e.preventDefault();
        document.getElementById("search-input").focus();
    }
    
    if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
        e.preventDefault();
        manualRefresh();
    }
});
</script>
</body>
    </html>
